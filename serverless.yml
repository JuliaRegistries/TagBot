service: tag-bot
provider:
  name: aws
package:
  individually: true
  exclude:
    - ./**
functions:
  github:
    runtime: go1.x
    handler: github/bin/github
    timeout: 30
    environment:
      API_BASE: ${cf:tag-bot-${self:provider.stage}.ServiceEndpoint}
      GITHUB_APP_ID: ${env:GITHUB_APP_ID}
      GITHUB_WEBHOOK_SECRET: ${env:GITHUB_WEBHOOK_SECRET}
      GITHUB_CONTACT_USER: ${env:GITHUB_CONTACT_USER}
      REGISTRATOR_USERNAME: ${env:REGISTRATOR_USERNAME}
      GIT_TAGGER_NAME: ${env:GIT_TAGGER_NAME}
      GIT_TAGGER_EMAIL: ${env:GIT_TAGGER_EMAIL}
    package:
      include:
        - ./github/bin/*
    layers:
      - arn:aws:lambda:us-east-1:553035198032:layer:git:5
    events:
      - http:
          path: /webhook/github
          method: post
  changelog:
    runtime: ruby2.5
    handler: changelog/changelog.main
    timeout: 20
    package:
      include:
        - ./changelog/**
        - ./vendor/**
    layers:
      - arn:aws:lambda:us-east-1:553035198032:layer:git:5
    events:
      - http:
          path: /internal/changelog
          method: get
